.RATTLE.DATA <-
NULL
.RATTLE.SCORE.IN <-
NULL
.RATTLE.SCORE.OUT <-
NULL
.Random.seed <-
c(403L, 10L, 1961879693L, 228683463L, 1588324270L, -654478840L, 
747730443L, -1564950807L, 1368709560L, 933860966L, 604336897L, 
295679379L, 1140739650L, -2011549196L, 1647791095L, -1336283155L, 
792074372L, 1378254506L, -1927908331L, -502537041L, 1643997878L, 
1231071456L, -1788898269L, -132052159L, -1382377936L, 907912270L, 
-2043384647L, 509339851L, -694553222L, -1261270916L, -1800938305L, 
52763029L, -1350176340L, -578993278L, 523020637L, -176052137L, 
149610302L, -1523366024L, -837309349L, -585573447L, -2063472120L, 
-1606455114L, -930174991L, 1899278883L, -1051919758L, -346537788L, 
-2012625273L, 1175256669L, 107536468L, 78234234L, 773708229L, 
-441111777L, 619841190L, 177543216L, -394802477L, 1524588785L, 
1780665376L, 81894078L, -1034998071L, 1843342459L, 338215498L, 
2051258028L, -1127206481L, -1027171995L, 365791004L, -1206219918L, 
-588945427L, 1552533543L, -162115506L, -892463960L, 77814443L, 
1803988937L, -995802152L, 392176262L, -1696009375L, 195065587L, 
2097637730L, 1867716564L, -1486789929L, 549955789L, -709353372L, 
1929678410L, -1466868811L, -1404082417L, -991710186L, 1719803584L, 
-1992488829L, -1586158431L, 1471171216L, 68778350L, -205531367L, 
-931574869L, -1886512742L, -177980068L, 769610847L, -2101048267L, 
-567601204L, 1430045474L, -1190347395L, -1381806473L, -1371310178L, 
1352357464L, -2126626885L, 1412944217L, -1116091672L, 1239716630L, 
-80702319L, 1566361923L, -1035877294L, -1276881180L, -1586753241L, 
-1229864579L, -1349220236L, -768710054L, -2071583067L, 1870656703L, 
-2008299706L, -701536816L, 89667571L, -1131933935L, 1255296832L, 
-1325713634L, 1910581225L, 806178075L, 434939690L, -1287767988L, 
-48525297L, -1747920059L, -383136516L, -765641902L, -1986274099L, 
-396714873L, -1767561362L, 354507080L, 869899595L, 1419329705L, 
-113942024L, -399355610L, 1779995201L, 1107647443L, 1286547842L, 
-616833612L, 346876215L, 106232877L, 735242564L, -1490198934L, 
-1401759531L, 507983471L, -1723456650L, -2050763616L, 840355171L, 
1352064513L, -772170384L, 2098494734L, 1590902649L, -964215029L, 
39338042L, 2105134908L, -1944998785L, -2107490347L, 572813804L, 
-903691454L, -1560392547L, -155863785L, 699862142L, -1262574536L, 
828703515L, -1397135239L, -1835372344L, -1435281162L, 1592486193L, 
105931107L, 4485938L, -529859452L, -300988217L, -2019200099L, 
-684427500L, -1123865158L, -793506811L, -1434541601L, 2046256230L, 
-1266474000L, -1428267757L, -695516495L, -1251250848L, 168862462L, 
-562094455L, -378811973L, 1002795914L, 81828460L, 1435751407L, 
-777020379L, -1947253540L, 917887666L, -1871151699L, 1098301799L, 
592928398L, 1199163240L, -1489404053L, -1917622007L, 1607794584L, 
-1466693946L, 1116623905L, -689536845L, 262593058L, 779901972L, 
-580562793L, 1884037773L, -878611548L, 144051594L, 2078095861L, 
1765463119L, -1388178602L, 911346176L, 1157063491L, -599301407L, 
1063497808L, -553643858L, -963804071L, -1255902101L, -225429030L, 
-1138752868L, -1350116193L, -2046406923L, -1493208180L, -1285160350L, 
-742427075L, -141748041L, 119416670L, -1054844556L, 976227986L, 
-2046811552L, -921350004L, -1229876896L, -909223710L, -176968536L, 
1014359756L, -1662707204L, 87251890L, -1639603216L, -1260924476L, 
-28242600L, -2104073862L, -13143632L, 1157204412L, 870596180L, 
-547825214L, -339320032L, 1937585084L, 698495056L, -740566046L, 
1904639848L, 88258380L, 1428655868L, 1408669426L, 1310637312L, 
-62747532L, 1646317064L, 1082770874L, 1648686544L, -2060961812L, 
-1042166892L, -492091182L, -1968970656L, -1776251572L, 1699648288L, 
-500745598L, 1507525096L, -1821656084L, 1695710780L, 2087986802L, 
1623960432L, -1865032412L, 776649272L, 326693274L, -1109070384L, 
468518332L, -1192595820L, -1348672894L, -1314202176L, 386742076L, 
758264464L, 99677986L, -930138616L, 2009236236L, 1314653084L, 
108567570L, -1534661760L, 1393007380L, 1249539368L, -1560793030L, 
-1495055408L, -1864762772L, 1202965556L, 1531490450L, 782055776L, 
-1089053364L, -25405984L, 1133894562L, 356866984L, 1290755212L, 
1522021308L, 841229426L, -39303184L, 1136796740L, 1025329240L, 
1782677562L, 1791674480L, 742555196L, 669214484L, -1450439998L, 
708072160L, 1306756220L, 1559612624L, -1847471198L, -1603334616L, 
715522316L, 174393276L, -1615941326L, 482400448L, -891940300L, 
-1990731064L, -2082438470L, 1242057872L, 664274668L, 1372575316L, 
-71145838L, 1955440416L, 700118988L, 243296480L, 1971998402L, 
1644155944L, 1776032684L, 382257852L, 223928818L, 694150704L, 
-408881244L, 536986040L, -102753446L, 1884984464L, -499377284L, 
36118292L, 794025282L, 1514082048L, -1421165636L, -1457905840L, 
-1300307678L, -405624248L, -602204148L, -401470372L, 466031058L, 
-1267755520L, -1736953516L, 1521524968L, -1585852166L, 379021008L, 
-931641044L, 1507358964L, -28349038L, 1917356384L, 1157269516L, 
-1388696864L, 445850210L, 1209907880L, -624313780L, -116799620L, 
1330203954L, -1939921296L, -1238877372L, -818001960L, 1098375034L, 
-778047952L, -402778180L, 1488819796L, 1361627202L, 177029280L, 
-1504497988L, -84293168L, 1605870434L, 107168488L, 1998930124L, 
-527908356L, -2121405966L, -591316352L, 1007842804L, 59877000L, 
-176447686L, -158481584L, -1823230868L, 1642150292L, -1453431726L, 
-1442600480L, -28541748L, -635589472L, -1736649342L, 23797992L, 
-1309212948L, -1100182212L, 901282930L, -1373183888L, -2029914076L, 
1938369592L, -1125943526L, 1206893776L, -1414113476L, 1756190612L, 
-438023294L, -407981632L, -682766788L, 793060752L, -43260382L, 
61971720L, 860751500L, 1692587804L, -1504796526L, -759658112L, 
158326292L, -365916376L, -1888595398L, 1412388304L, 906037612L, 
1511859124L, 328730642L, -390550048L, 573276108L, 1903419616L, 
-1912023006L, -1330953944L, -552223220L, -1718886596L, -628966414L, 
-1473729808L, 130655812L, 1523737176L, 1800036154L, 618804720L, 
74649276L, -1793664748L, 1266825922L, 1418431584L, 1280947068L, 
-1867184176L, -632880862L, -783758680L, -1676381300L, 2096834748L, 
-628988110L, 1103792704L, -1388534604L, 940014152L, -370418246L, 
2063546896L, -981628180L, 1212041556L, -1549287150L, -216777312L, 
-1765332704L, -1234859767L, -927457733L, 820908940L, -1943162342L, 
1351185039L, -801120807L, -736640402L, -863645188L, -745290899L, 
-1510658793L, 1062488288L, -1428361538L, 1434909835L, -1881048307L, 
-1721889990L, 1809277816L, 1549316385L, -1886725677L, -1684633356L, 
1817987458L, 941251607L, 731818721L, -502664154L, 1448628516L, 
-1587408427L, 485903743L, 208942104L, 1475435318L, -886579773L, 
753464325L, 1636487074L, -830682224L, 35573561L, -2061190165L, 
568634588L, 1271821578L, 339606527L, 184008265L, 1783802846L, 
1220875148L, -1229434019L, 945525607L, 2142271632L, 1519822510L, 
-734215333L, -635776195L, -330114646L, -556026296L, 1079871089L, 
-2110031901L, -714505500L, 469424658L, -406155801L, -830039631L, 
-1381158922L, 477688340L, -971932379L, -1317466577L, -934478872L, 
1484295366L, 921811315L, -1784872491L, 782980530L, 686599040L, 
-316788887L, 191374299L, 1413614380L, -861907654L, -1114854417L, 
634683001L, -1123022578L, 1346230492L, -826421427L, -1353105737L, 
-49861568L, 2011620638L, -1277853717L, 1459045229L, -1656811046L, 
1712343960L, 621638145L, 749691827L, -906919212L, 1021993954L, 
211793527L, -1855213631L, -310784698L, 1779620996L, 2012373557L, 
834578975L, 1596517752L, -74683306L, 1111322851L, 866506405L, 
-1516332222L, 1104507184L, 1173801305L, 591448779L, -592268484L, 
869866346L, -208963169L, 2147119145L, -2029139266L, 839945132L, 
-1445349123L, 461354055L, 1679905584L, 706303054L, 195770491L, 
1472560093L, 1924276746L, 2101626664L, -1876960879L, 1275748227L, 
2080969860L, -1951083854L, 1596392967L, -112785839L, 111328726L, 
-269053772L, -2009150267L, -2015425009L, 1967195784L, 1278700454L, 
1127195475L, 1221684405L, 108169746L, 1499645920L, 1997855305L, 
580178043L, -672759476L, -1264642854L, -399616817L, 168525977L, 
87235758L, -2009880132L, -999583187L, -281549353L, 1599843360L, 
-194997890L, -369017013L, -72448691L, 1232325498L, 1892928952L, 
-556339359L, 1268860691L, 1258479412L, -1881436862L, -2000600745L, 
1579912353L, -584968858L, -1218447516L, 1664169621L, -1272746049L, 
-1244941480L, 312643958L, 2074776451L, -757182011L, 1839855330L, 
1741330256L, 1741173369L, -1997638229L, 263256860L, -210318262L, 
2124814399L, 136693897L, 1990216862L, -1535837876L, -1765328661L
)
.ofLogitnorm <-
function(
	### Objective function used by \code{\link{coefLogitnorm}}. 
	theta				##<< theta[1] is mu, theta[2] is the sigma
	,quant				##<< q are the quantiles for perc
	,perc=c(0.5,0.975) 
){
	# there is an analytical expression for the gradient, but here just use numerical gradient
	
	# calculating perc should be faster than calculating quantiles of the normal distr.
	if( theta[2] <= 0) return( Inf )
	tmp.predp = plogitnorm(quant, mu=theta[1], sigma=theta[2] )
	tmp.diff = tmp.predp - perc
	
	#however, q not so long valley and less calls to objective function
	#but q has problems with high sigma
	#tmp.predq = qlogitnorm(perc, mean=theta[1], sigma=theta[2] )
	#tmp.diff =  tmp.predq - quant
	sum(tmp.diff^2)
}
.ofLogitnormE <-
function(
	### Objective function used by \code{\link{coefLogitnormE}}. 
	theta				##<< theta[1] is the mu, theta[2] is the sigma
	,mean				##<< the expected value of the density distribution
	,quant				##<< q are the quantiles for perc
	,perc=c(0.975) 
	,...				##<< further argument to \code{\link{momentsLogitnorm}}.
){
	tmp.predp = plogitnorm(quant, mu=theta[1], sigma=theta[2] )
	tmp.diff = tmp.predp - perc
	.exp <- momentsLogitnorm(theta[1],theta[2],...)["mean"]
	tmp.diff.e <- mean-.exp
	sum(tmp.diff^2) + tmp.diff.e^2
}
.ofLogitnormMLE <-
function(
	### Objective function used by \code{\link{coefLogitnormMLE}}. 
	mu	##<< numeric vector of proposed parameter				
		## make sure that logit(mu)<mle for mle>0.5 and logit(mu)>mle for mle<0.5
	,mle				##<< the mode of the density distribution
	,logitMle=logit(mle)##<< may provide for performance reasons
	,quant				##<< q are the quantiles for perc
	,perc=c(0.975) 
){
	# given mu and mle, we can calculate sigma
	sigma2 = (logitMle-mu)/(2*mle-1)
	ifelse( sigma2 <= 0, Inf, {
		tmp.predp = plogitnorm(quant, mu=mu, sigma=sqrt(sigma2) )
		tmp.diff = tmp.predp - perc
		tmp.diff^2
	})
}
.ofModeLogitnorm <-
function(
	### Objective function used by \code{\link{coefLogitnormMLE}}.
	mle		##<< proposed mode
	,mu	##<< parameter mu 
	,sd2	##<< parameter sigma^2
){
	if( mle <=0 | mle >=1) return(.Machine$double.xmax)
	tmp.diff.mle <- mu-sd2*(1-2*mle)   - logit(mle)
	tmp.diff.mle^2
}
